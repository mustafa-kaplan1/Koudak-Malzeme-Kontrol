@model KoudakMalzeme.MvcUI.Models.KullaniciProfilViewModel
@{
	ViewData["Title"] = "Kullanıcı Profili";
}

<div class="row">
	<div class="col-md-4 mb-4">
		<div class="card shadow border-0 text-center h-100">
			<div class="card-body">
				<div class="bg-success text-white rounded-circle mx-auto d-flex justify-content-center align-items-center mb-3 display-4 shadow"
					style="width: 100px; height: 100px;">
					@(Model.Kullanici.Ad.Length > 0 ? Model.Kullanici.Ad[0] : '?')
				</div>
				<h3 class="fw-bold">@Model.Kullanici.Ad @Model.Kullanici.Soyad</h3>
				<p class="text-muted mb-1">@Model.Kullanici.OkulNo</p>
				<p class="badge bg-dark mb-4">@Model.Kullanici.Rol</p>

				<ul class="list-group list-group-flush text-start">
					<li class="list-group-item"><i class="fa-solid fa-envelope text-success me-2"></i>
						@Model.Kullanici.Email</li>
					<li class="list-group-item"><i class="fa-solid fa-phone text-success me-2"></i>
						@Model.Kullanici.Telefon</li>
					<li class="list-group-item"><i class="fa-solid fa-calendar text-success me-2"></i> Kayıt:
						@Model.Kullanici.OlusturulmaTarihi.ToString("dd.MM.yyyy")</li>
				</ul>

				@if (Model.KendiProfiliMi)
				{
					<div class="mt-4 d-grid gap-2">
						<a asp-controller="Emanet" asp-action="Ver" class="btn btn-success">
							<i class="fa-solid fa-plus"></i> Yeni Emanet İste
						</a>
						<button class="btn btn-outline-secondary" disabled>Bilgilerimi Güncelle</button>
					</div>
				}
			</div>
		</div>
	</div>

	<div class="col-md-8">
		<div class="card shadow border-0">
			<div class="card-header bg-white border-bottom-0 pt-4 pb-0">
				<h5 class="fw-bold text-success"><i class="fa-solid fa-clock-rotate-left"></i> Emanet Geçmişi</h5>
			</div>
			<div class="card-body">
				@if (Model.Emanetler.Count == 0)
				{
					<div class="text-center py-5 text-muted">
						<i class="fa-solid fa-box-open fa-3x mb-3"></i>
						<p>Henüz kayıtlı bir emanet işlemi yok.</p>
					</div>
				}
				else
				{
					<div class="table-responsive">
						<table class="table table-hover align-middle">
							<thead class="table-light">
								<tr>
									<th>Tarih</th>
									<th>Malzemeler</th>
									<th>Durum</th>
									<th>İşlem</th>
								</tr>
							</thead>
							<tbody>
								@foreach (var emanet in Model.Emanetler)
								{
									<tr>
										<td>@emanet.TeslimAlmaTarihi.ToString("dd.MM.yyyy")</td>
										<td>
											<ul class="list-unstyled mb-0 small">
												@foreach (var detay in emanet.EmanetDetaylari)
												{
													<li>• @detay.Malzeme.Ad (@detay.AlinanAdet adet)</li>
												}
											</ul>
										</td>
										<td>
											@if (emanet.Durum == KoudakMalzeme.Shared.Enums.EmanetDurumu.TeslimEdildi)
											{
												<span class="badge bg-warning text-dark">Aktif</span>
											}
											else if (emanet.Durum == KoudakMalzeme.Shared.Enums.EmanetDurumu.Tamamlandi)
											{
												<span class="badge bg-success">İade Edildi</span>
											}
											else
											{
												<span class="badge bg-danger">@emanet.Durum</span>
											}
										</td>
										<td>
											@if (emanet.Durum != KoudakMalzeme.Shared.Enums.EmanetDurumu.Tamamlandi)
											{
												// Eğer kendi profili veya yetkili ise İade butonu göster
												if (Model.KendiProfiliMi || User.IsInRole("Admin") || User.IsInRole("Malzemeci"))
												{
													<a asp-controller="Emanet" asp-action="IadeAl" asp-route-id="@emanet.Id"
														class="btn btn-sm btn-outline-success">
														<i class="fa-solid fa-rotate-left"></i> İade Et
													</a>
												}
											}
										</td>
									</tr>
								}
							</tbody>
						</table>
					</div>
				}
			</div>
		</div>
	</div>
</div>