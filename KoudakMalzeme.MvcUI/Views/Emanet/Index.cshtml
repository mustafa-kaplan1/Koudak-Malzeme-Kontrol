@model List<KoudakMalzeme.Shared.Entities.Emanet>
@{
	ViewData["Title"] = "Emanet Kayıtları";
}

<h2 class="mb-4 text-primary"><i class="fa-solid fa-list-check"></i> Emanet Kayıtları</h2>

<div class="card shadow-sm">
	<div class="card-body">
		<div class="table-responsive">
			<table class="table table-hover align-middle">
				<thead class="table-light">
					<tr>
						<th>Durum</th>
						<th>Alan Üye</th>
						<th>Veren Yetkili</th>
						<th>İade Alan</th>
						<th>Veriliş Tarihi</th>
						<th>İade Tarihi</th>
						<th>İşlem</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var item in Model)
					{
						<tr>
							<td>
								@if (item.Durum == KoudakMalzeme.Shared.Enums.EmanetDurumu.TeslimEdildi)
								{
									<span class="badge bg-warning text-dark">Aktif (Zimmetli)</span>
								}
								else if (item.Durum == KoudakMalzeme.Shared.Enums.EmanetDurumu.Tamamlandi)
								{
									<span class="badge bg-success">Tamamlandı</span>
								}
								else
								{
									<span class="badge bg-secondary">@item.Durum</span>
								}
							</td>
							<td class="fw-bold">@item.Uye?.Ad @item.Uye?.Soyad</td>
							<td>@item.VerenPersonel?.Ad @item.VerenPersonel?.Soyad</td>
							<td>
								@(item.AlanPersonel != null ? $"{item.AlanPersonel.Ad} {item.AlanPersonel.Soyad}" : "-")
							</td>
							<td>@item.TeslimAlmaTarihi.ToString("dd.MM.yyyy")</td>
							<td>
								@(item.IadeTarihi.HasValue? item.IadeTarihi.Value.ToString("dd.MM.yyyy") : "-")
							</td>
							<td>
								<button class="btn btn-sm btn-outline-info" data-bs-toggle="modal"
									data-bs-target="#detayModal-@item.Id">
									<i class="fa-solid fa-eye"></i> Detay
								</button>
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	</div>
</div>

@foreach (var item in Model)
{
	<div class="modal fade" id="detayModal-@item.Id" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-light">
					<h5 class="modal-title text-primary fw-bold">
						<i class="fa-solid fa-file-invoice me-2"></i>Emanet Detayı
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<h6 class="text-muted small text-uppercase fw-bold mb-3">Verilen Malzemeler</h6>
					<ul class="list-group list-group-flush border rounded mb-3">
						@foreach (var d in item.EmanetDetaylari)
						{
							<li class="list-group-item d-flex justify-content-between align-items-center">
								<span>@d.Malzeme.Ad</span>
								<span class="badge bg-primary rounded-pill">@d.AlinanAdet Adet</span>
							</li>
						}
					</ul>

					<div class="alert alert-secondary mb-0">
						<i class="fa-solid fa-circle-info me-2"></i>
						<b>Malzemeci Notu:</b> @(item.MalzemeciNotu ?? "Not girilmemiş.")
					</div>
				</div>
				<div class="modal-footer bg-light">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
				</div>
			</div>
		</div>
	</div>
}