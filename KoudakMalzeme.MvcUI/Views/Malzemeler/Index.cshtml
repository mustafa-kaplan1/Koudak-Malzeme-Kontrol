@model List<KoudakMalzeme.Shared.Entities.Malzeme>

@{
	ViewData["Title"] = "Malzeme Listesi";
	// Kullanıcının rolünü kontrol et (Admin veya Malzemeci mi?)
	bool yetkili = User.IsInRole("Admin") || User.IsInRole("Malzemeci");
	bool admin = User.IsInRole("Admin");
}

<div class="d-flex justify-content-between align-items-center mb-4">
	<h2 class="text-success"><i class="fa-solid fa-layer-group"></i> Malzeme Stoğu</h2>
	@if (yetkili)
	{
		<a asp-action="Ekle" class="btn btn-success"><i class="fa-solid fa-plus"></i> Yeni Malzeme Ekle</a>
	}
</div>

<div class="row">
	@foreach (var item in Model)
	{
		<div class="col-md-4 col-lg-3 mb-4">
			<div class="card h-100 border-0 shadow-sm">
				<img src="@(string.IsNullOrEmpty(item.GorselYolu) ? "https://via.placeholder.com/300x200?text=Koudak" : item.GorselYolu)"
					class="card-img-top" alt="@item.Ad" style="height: 200px; object-fit: cover;">

				<div class="card-body">
					<h5 class="card-title fw-bold text-dark">@item.Ad</h5>
					<p class="card-text text-muted small">@item.Aciklama</p>

					<div class="d-flex justify-content-between mt-3">
						<span class="badge bg-secondary p-2">Top: @item.ToplamStok</span>
						<span class="badge @(item.GuncelStok > 0 ? "bg-success" : "bg-danger") p-2">
							Raf: @item.GuncelStok
						</span>
					</div>
				</div>

				@if (yetkili)
				{
					<div class="card-footer bg-white border-top-0 d-flex justify-content-between">
						<a asp-action="Duzenle" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary">
							<i class="fa-solid fa-pen"></i> Düzenle
						</a>

						@if (admin)
						{
							<form asp-action="Sil" asp-route-id="@item.Id" method="post"
								onsubmit="return confirm('Bu malzemeyi silmek istediğine emin misin?');">
								<button type="submit" class="btn btn-sm btn-outline-danger">
									<i class="fa-solid fa-trash"></i>
								</button>
							</form>
						}
					</div>
				}
			</div>
		</div>
	}

	@if (Model.Count == 0)
	{
		<div class="col-12 text-center py-5">
			<p class="text-muted lead">Henüz kayıtlı malzeme yok.</p>
		</div>
	}
</div>